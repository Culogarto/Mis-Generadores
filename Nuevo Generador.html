<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TVGram Launcher Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #0f172a;
            color: #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            user-select: none;
        }
        .glass-panel {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.5);
        }
        .input-field {
            background-color: #1e293b;
            border: 1px solid #334155;
            color: white;
            transition: all 0.3s ease;
        }
        .input-field:focus {
            outline: none;
            border-color: #8b5cf6;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2);
        }
        .btn-primary {
            background: linear-gradient(135deg, #7c3aed 0%, #4c1d95 100%);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(124, 58, 237, 0.4);
        }
        .code-preview {
            font-family: 'Courier New', monospace;
            font-size: 0.75rem;
            color: #94a3b8;
            background: #020617;
            padding: 0.5rem;
            border-radius: 0.5rem;
            border: 1px solid #1e293b;
            margin-top: 0.5rem;
            word-break: break-all;
        }
    </style>
</head>
<body oncontextmenu="return false">

    <div id="toast" class="fixed top-5 left-1/2 transform -translate-x-1/2 px-6 py-4 rounded-full shadow-2xl transition-all duration-300 opacity-0 -translate-y-8 pointer-events-none z-50 flex items-center space-x-3 font-bold bg-white text-slate-900">
        <i id="toast-icon" class="fas fa-check-circle text-green-500 text-xl"></i>
        <span id="toast-message">Notificación</span>
    </div>

    <div class="w-full max-w-md p-4">
        <div class="text-center mb-6">
            <div class="w-20 h-20 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-2xl mx-auto flex items-center justify-center shadow-xl mb-4 transform rotate-3 hover:rotate-0 transition-transform">
                <i class="fas fa-satellite-dish text-3xl text-white"></i>
            </div>
            <h1 class="text-2xl font-bold text-white tracking-tight">TVGram <span class="text-purple-400">Launcher</span></h1>
            <p class="text-slate-400 text-xs mt-1">Generador compatible con API v1.0</p>
        </div>

        <div class="glass-panel p-6 space-y-6">
            
            <div class="space-y-2">
                <label class="block text-xs font-bold uppercase text-purple-300 tracking-wider ml-1">
                    <i class="fas fa-link mr-1"></i> Enlace de Origen
                </label>
                <input type="text" id="input_url" 
                       placeholder="Pega aquí: t.me/..., http://..., m3u8..." 
                       class="input-field w-full p-4 rounded-xl text-sm font-mono"
                       oninput="updatePreview()">
                <p class="text-[10px] text-slate-500 ml-1">
                    * Detecta automáticamente si es Canal, Grupo Privado o Vídeo.
                </p>
            </div>

            <div class="space-y-2">
                <label class="block text-xs font-bold uppercase text-slate-400 tracking-wider ml-1">
                    <i class="fas fa-tag mr-1"></i> Título del Botón
                </label>
                <input type="text" id="input_title" 
                       placeholder="Ej: Ver Partido" 
                       class="input-field w-full p-3 rounded-xl text-sm font-bold text-center">
            </div>

            <div id="preview-box" class="hidden">
                <label class="block text-[10px] font-bold text-slate-500 uppercase ml-1">Deep Link Generado:</label>
                <div id="code-output" class="code-preview">Esperando enlace...</div>
            </div>

            <button onclick="generate()" class="btn-primary w-full py-4 rounded-xl font-bold text-white text-lg flex items-center justify-center gap-2 group">
                <span>Generar Lanzador</span>
                <i class="fas fa-rocket group-hover:translate-x-1 transition-transform"></i>
            </button>

        </div>

        <p class="text-center text-[10px] text-slate-600 mt-6 opacity-50">
            Fix +Symbol applied • API Compliant • Secure Build
        </p>
    </div>

    <script>
        // Protección básica contra curiosos
        document.addEventListener('keydown', function(e) {
            if (e.keyCode == 123 || (e.ctrlKey && e.shiftKey && e.keyCode == 73)) { e.preventDefault(); }
        });

        function showToast(msg, type='success'){
            const t = document.getElementById('toast');
            const m = document.getElementById('toast-message');
            const i = document.getElementById('toast-icon');
            m.innerText = msg;
            i.className = type === 'error' ? "fas fa-exclamation-triangle text-red-500 text-xl" : "fas fa-check-circle text-green-500 text-xl";
            t.classList.remove('opacity-0', '-translate-y-8');
            setTimeout(() => t.classList.add('opacity-0', '-translate-y-8'), 3000);
        }

        function processUrl(url, title) {
            url = url.trim();
            title = encodeURIComponent(title.trim() || "Abrir");
            
            // 1. LIMPIEZA: Si es un enlace de Drive sucio
            if (url.includes('drive.google.com') && url.includes('/file/d/')) {
                const m = url.match(/\/file\/d\/([a-zA-Z0-9_-]+)/);
                if(m && m[1]) url = `https://drive.google.com/uc?export=download&id=${m[1]}`;
            }

            // 2. LÓGICA DE TELEGRAM (Invitaciones y Canales)
            // Detectar formatos: t.me/..., telegram.me/..., o @usuario
            if (url.includes('t.me/') || url.includes('telegram.me/') || url.startsWith('@')) {
                
                // Limpiar prefijos para quedarnos con el "slug" o "hash"
                let clean = url.replace('https://', '').replace('http://', '').replace('t.me/', '').replace('telegram.me/', '').replace('@', '');
                
                // DETECCIÓN DE INVITACIÓN PRIVADA (Empieza por +)
                if (clean.startsWith('+')) {
                    // APLICAR FIX API: Codificar el '+' como '%2B'
                    // Usamos el Método A (tvgram://t.me/...) que es más universal
                    return `tvgram://t.me/${clean.replace('+', '%2B')}?title=${title}`;
                } 
                // DETECCIÓN DE CANAL PÚBLICO O USUARIO
                else {
                    return `tvgram://t.me/${clean}?title=${title}`;
                }
            }
            
            // 3. LÓGICA DE VÍDEO DIRECTO (M3U8, MP4, MKV)
            // Si no es Telegram, asumimos que es un vídeo para el Player
            else {
                return `tvgram://play?url=${encodeURIComponent(url)}&title=${title}`;
            }
        }

        function updatePreview() {
            const u = document.getElementById('input_url').value;
            const t = document.getElementById('input_title').value;
            const b = document.getElementById('preview-box');
            const o = document.getElementById('code-output');
            
            if(u.length > 5) {
                b.classList.remove('hidden');
                const result = processUrl(u, t);
                o.innerText = result;
                o.style.color = result.includes('%2B') ? '#4ade80' : '#94a3b8'; // Verde si aplica el fix
            } else {
                b.classList.add('hidden');
            }
        }

        function generate() {
            const u = document.getElementById('input_url').value;
            const t = document.getElementById('input_title').value || "Abrir";
            
            if (!u) { showToast("Falta el enlace", "error"); return; }

            const deepLink = processUrl(u, t);
            const fileName = "LAUNCH_" + t.replace(/[^a-z0-9]/gi, '_').toUpperCase();
            
            // Plantilla HTML optimizada para ejecución rápida
            const htmlContent = `<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>${t}</title><style>body{background:#000;display:flex;justify-content:center;align-items:center;height:100vh;margin:0;font-family:sans-serif;color:#fff}.btn{background:#fff;color:#000;border:none;padding:15px 30px;font-size:18px;border-radius:30px;font-weight:bold;cursor:pointer;box-shadow:0 0 20px rgba(255,255,255,0.3)}</style></head><body><button onclick="go()" class="btn">ABRIR AHORA</button><script>function go(){window.location.href="${deepLink}";}setTimeout(go,500);<\/script></body></html>`;

            const blob = new Blob([htmlContent], {type: 'text/html'});
            const urlObj = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = urlObj;
            a.download = fileName + ".html";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(urlObj);
            
            showToast("¡Archivo Generado!");
        }
    </script>
</body>
</html>